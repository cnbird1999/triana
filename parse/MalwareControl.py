#-------------------------------------------------------------------------------
# Name:        module1
# Purpose:
#
# Author:      Silverhack
#
# Created:     01/06/2012
# Copyright:   (c) Silverhack 2012
# Licence:     <your licence>
#-------------------------------------------------------------------------------


from bs4 import BeautifulSoup
from util.TableParse import parse,clean as limpia
import urlparse
import os
from common.constants import COLLECTOR_ROOT
import logging

try:
    log = logging.getLogger(__name__)
except:
    pass

actual = os.getcwd()
tabla =[]
malicious=[]

def fetch():
    log.info("Fetch results from Malware Control")
    try:
        fich = open(os.path.join(COLLECTOR_ROOT,"malware","malwarecontrol"),"r")
        data= fich.read()
        fich.close()
        soup = BeautifulSoup(data)
        for element in soup.findAll('span',{'style':'margin-left:30px;'}):
                element = element.renderContents()
                malicious.append(element.rstrip('\n'))
        table =soup.find("table")
        tabla = parse(str(table))
        return (malicious,tabla)
    except IOError as e:
        log.error("No such file or directory...")
        log.error(e)
        return (False,False)
