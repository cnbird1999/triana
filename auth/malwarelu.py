#-------------------------------------------------------------------------------
# Name:        MalwareLu
# Purpose:     Class to search and download in Malware.lu
# Author:      Juan Garrido (A.K.A silverhack)
# Created:     22/04/2013
# Copyright (C) 2013 Threat Intelligent Analysis.
# This file is part of TRIANA http://www.innotecsystem.com
# See the file 'docs/LICENSE' for copying permission.
#-------------------------------------------------------------------------------
import requests
import sys,os
import logging
from common.constants import COLLECTOR_ROOT
log = logging.getLogger()

class MalwareLu:
    def __init__(self):
        self.legend = "Trying to search and download sample in malware.lu"
    def SearchAndDownload(self,API_KEY=False,HASH=False,URL=False):
        try:
            log.info(self.legend)
            payload = {"apikey":API_KEY,"hash":HASH}
            data = requests.post(URL,data=payload,
                                 verify=False)
            if data.content.__contains__("error"):
                log.info("Hash not in database")
            else:
                out = open(os.path.join(COLLECTOR_ROOT,'download',"malwarelu"), 'wb')
                out.write(data.content)
                out.close()
        except Exception as error:
            log.error(error)
